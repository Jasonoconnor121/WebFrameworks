extends layout

block content
  form#loginForm(action="/api/archerLogin" method="POST")
    .form-group
      label(for='username')= pageInfo.email
      input#username.form-control(name= 'username' type='username' aria-describedby='emailHelp' placeholder='Enter username')
    .form-group
      label(for='exampleInputPassword1')= pageInfo.password
      small#emailHelp.form-text.text-muted= pageInfo.passwordHelp
      input#exampleInputPassword1.form-control(name = 'password' type='password' placeholder='Password')
    button.btn.btn-primary(type='submit')= pageInfo.button
    .pTextinBody
      | Not a Member?
      a(href='/register')= pageInfo.linkText
  

  script.
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const payload = Object.fromEntries(formData.entries());

            fetch(this.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || 'Failed to log in');
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.message === 'Login successful') {
                    alert('Login Successful');
                    window.location.href = '/classTimes'; // Redirect to the next page
                } else {
                    alert('Login failed: ' + data.message);
                }
            })
            .catch(err => {
                alert('Error: ' + err.message);
                console.error('Login error:', err);
            });
         });